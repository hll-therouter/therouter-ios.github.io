---
layout: post
title: "从零接入 TheRouter"
description: "新手零基础入门教程。   "
categories: docs  
level: 1
tag: "入门教程" 

---

TheRouter是货拉拉开源的路由框架，针对 Android 平台实现组件化、跨模块调用、动态化等功能的集成框架，基本上算当前最先进的路由库了。   
Github: [https://github.com/HuolalaTech/hll-wp-therouter-android/](https://github.com/HuolalaTech/hll-wp-therouter-android/)   
官网：[http://therouter.cn/](http://therouter.cn/)  

  
## 开始之前

如果你的项目之前使用过其他路由，建议使用迁移工具一键迁移： [https://therouter.cn/docs/2022/09/05/01](https://therouter.cn/docs/2022/09/05/01)   

如果你的是新项目，请先记住一点：**plugin、apt、router 三个依赖的版本号必须保持一致**，请继续往下看接入步骤。   


## 查看最新版本

TheRouter 的版本分为两种，稳定版和 rc版，一般不追求新功能我们就用稳定版就行，可以在官网看到最新的版本号和各种版本的说明：[https://therouter.cn/docs/2022/09/06/01](https://therouter.cn/docs/2022/09/06/01)  

## 接入

新建一个`Demo`工程，打开`Demo`的根目录`build.gradle`。

### 第一步：接入classpath

####  7.X 以后的新版本 Gradle

如果是新版本的 Gradle，`classpath`已经改为用`plugins`的方式引入，只需要在闭包内加这一句就行了

```groovy
id 'cn.therouter' version '1.1.4-rc4' apply false
```

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d9a373ad726141a1b77d548e99de3656~tplv-k3u1fbpfcp-zoom-1.image" class="blog-img">

#### 6.x 及之前的老版本 Gradle

对于6.x 及之前的  Gradle，需要手动引入`classpath`，在 TheRouter 官方 Github 首页也有接入介绍

```groovy
classpath "cn.therouter:plugin:1.1.4-rc4"
```

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9e17c86607e14d0888bf2ab30b34d3b1~tplv-k3u1fbpfcp-zoom-1.image" class="blog-img">
  


### 第二步：引入插件

####  7.X 以后的新版本 Gradle

找到项目里全部的app模块（一般只会有一个，特殊项目会有多个）。也就是整个工程的所有`build.gradle`文件里面，只要是有`com.android.application`这个的模块，都要加上如下代码

```groovy
// 7.X及以上新版本这样写
id 'therouter'
```

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cefce8ad9c243a49bb5445128525b83~tplv-k3u1fbpfcp-zoom-1.image" width=240>   

#### 6.x 及之前的老版本 Gradle

找到项目里全部的app模块（一般只会有一个，特殊项目会有多个）。也就是整个工程的所有`build.gradle`文件里面，只要是有`com.android.application`这个的模块，都要加上如下代码

```groovy
// 6.X及以下老版本这样写
apply plugin: 'therouter'
```

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a8bfb7c684a40268e3297285b4643e4~tplv-k3u1fbpfcp-zoom-1.image" width=240>


### 第三步：引入注解处理器

最新版的 TheRouter 已经支持`KSP`解析，如果你都不知道`KSP`是什么，那么就继续往下看，使用`kapt`吧。如果你希望使用`KSP`，可以看文档：[使用 KSP 处理注解](https://therouter.cn/docs/2023/05/15/01)。  
  
TheRouter 的注解处理依赖`kapt`执行，所以要在项目里面手动引入，否则无法处理注解。  

**注：所有的模块都必须引入kapt，否则就有可能造成某些路由表不生成。**  
**注：所有APP的模块，如果是需要上线的模块，必须直接或间接在 app 中被依赖，否则最终生成apk会丢失未被依赖的功能。**  

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef8fb789721548b4bc7a11563ecc328b~tplv-k3u1fbpfcp-zoom-1.image" class="blog-img">   

如果报找不到kapt，可能是因为没有声明kotlin-kapt的插件，参考`步骤二`里面的截图，接入对应的kapt。  
如果是纯Java工程，需要用Java的APT处理，纯Java就不用声明`kotlin-kapt`插件了，直接把`kapt`改成`annotationProcessor`


```groovy
annotationProcessor "cn.therouter:apt:1.1.4-rc4"
```

### 第四步：引入路由库

在需要使用路由功能的模块的`build.gradle`，(不像kapt，这个是可以使用传递依赖的)，加入如下依赖  

```
dependencies {
    implementation "cn.therouter:router:1.1.4-rc4"
}
```


## 使用

#### 1. 声明路由

给需要跳转的页面加上路由表声明

```java
@Route(path = "http://therouter.com/home")
public class HomeActivity extends BaseActivity {
}
```

#### 2. 添加参数注入

这一步如果在base里面写了的话就不用每个Activity都加了。

```java
@Override
protected void onCreate(@Nullable Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    TheRouter.inject(this);
}
```

#### 3. 发起跳转

也就是原来使用startActivity()的方法，都可以改成这样使用了

```java
@Override
protected void onCreate(@Nullable Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    TheRouter.build("要跳转的目标页Path")
        .withInt("intValue", 12345678) 
        .withString("str_123_Value", "传中文字符串")
        .withBoolean("boolValue", true)
        .withLong("longValue", 123456789012345L)
        .withChar("charValue", 'c')
        .withDouble("double", 3.14159265358972)
        .withFloat("floatValue", 3.14159265358972F)
        .navigation();
        
    TheRouter.build("如果没有参数，可以什么都不传").navigation();
}
```

## AGP 8.X 使用

由于 AGP 从 7.X 开始，把 `TransfromAPI` 废弃(会有警告，但还能正常使用)，从 8.0 开始删除了，所以老版本是无法使用的。对于新版本，由于 8.0 的 AGP 还没有正式发布，所以我们也只在 Beta 版本支持，以防止再有什么 API 变动。  
具体版本号及开发进度请关注 [release](https://github.com/HuolalaTech/hll-wp-therouter-android/releases) 信息（1.2.0-betaX为AGP8适配版本）     
  
